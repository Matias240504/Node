<!DOCTYPE html>
<html lang="es">
<head>
    <%- include('./partials/styles', { title: 'Cambiar Rol' }) %>
    <style>
        .form-container {max-width:500px;margin:40px auto;padding:30px;background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1);}        
        .form-group {margin-bottom:20px;}        
        label {display:block;font-weight:600;margin-bottom:6px;}        
        select,button {width:100%;padding:10px;border:1px solid #ccc;border-radius:4px;font-size:1rem;}        
        button {background:var(--primary-color);color:#fff;border:none;cursor:pointer;font-weight:600;}        
        button:hover {background:var(--primary-hover);}        
    </style>
</head>
<body>
    <div class="dashboard-container">
        <%- include('./partials/sidebar', { currentPath: '/juez/cambiarRol', user: user }) %>
        <div class="main-content">
            <h2>Cambiar Rol de Usuario</h2>
            <div class="form-container">
                <form id="cambiarRolForm">
                    <div class="form-group">
                        <label>Usuario:</label>
                        <p><%= targetUser.nombre %> <%= targetUser.apellido %> (<%= targetUser.email %>)</p>
                    </div>
                    <div class="form-group">
                        <label for="rolSelect">Nuevo Rol:</label>
                        <select id="rolSelect" name="rol">
                            <% rolesPermitidos.forEach(function(r){ %>
                                <option value="<%= r %>" <%= r===targetUser.rol? 'selected':'' %>><%= r.charAt(0).toUpperCase()+r.slice(1) %></option>
                            <% }) %>
                        </select>
                    </div>
                    <button type="submit">Actualizar Rol</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        document.getElementById('cambiarRolForm').addEventListener('submit', async function(e){
            e.preventDefault();
            const rol = document.getElementById('rolSelect').value;
            const res = await fetch('/juez/cambiarRol/<%= targetUser._id %>', {
                method:'POST',
                headers:{
                    'Content-Type':'application/json',
                    'Authorization':'Bearer '+localStorage.getItem('token')
                },
                body: JSON.stringify({rol})
            });
            const data = await res.json();
            if(res.ok){
                alert('Rol actualizado');
                window.location.href = '/juez/dashboard';
            }else{
                alert(data.message || 'Error');
            }
        });
    </script>
</body>
</html>
